{% extends 'base.html' %}

{% block title %}Attendance List{% endblock %}

{% block content_title %}Attendance List{% endblock %}
{% block content %}
<div class="attendance-container">
    <div class="attendance-content">
        {% if not attendance.time_in %}
            <form method="post" id="clockInForm">
                {% csrf_token %}
                <input type="hidden" name="latitude" id="latitude">
                <input type="hidden" name="longitude" id="longitude">
                <button type="submit" class="attendance-btn clock-in">Clock In</button>
            </form>
        {% elif not attendance.time_out %}
            <p>Clocked in at: {{ attendance.time_in }}</p>
            <form method="post" id="clockOutForm">
                {% csrf_token %}
                <input type="hidden" name="latitude" id="latitude">
                <input type="hidden" name="longitude" id="longitude">
                <button type="submit" class="attendance-btn clock-out">Clock Out</button>
            </form>
        {% else %}
            <p>Clocked in at: {{ attendance.time_in }}</p>
            <p>Clocked out at: {{ attendance.time_out }}</p>
            {% if attendance.distance_in is not None %}
                <p>Distance at check-in: {{ attendance.distance_in|floatformat:2 }} km</p>
            {% endif %}
            {% if attendance.distance_out is not None %}
                <p>Distance at check-out: {{ attendance.distance_out|floatformat:2 }} km</p>
            {% endif %}
        {% endif %}
    </div>
</div>

<script>
    function getLocation(formId) {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(function(position) {
                document.getElementById('latitude').value = position.coords.latitude;
                document.getElementById('longitude').value = position.coords.longitude;
                document.getElementById(formId).submit();
            }, function(error) {
                console.error("Error: " + error.message);
                alert("Unable to retrieve your location. Please ensure location services are enabled.");
            });
        } else {
            alert("Geolocation is not supported by your browser");
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        var clockInForm = document.getElementById('clockInForm');
        var clockOutForm = document.getElementById('clockOutForm');

        if (clockInForm) {
            clockInForm.addEventListener('submit', function(e) {
                e.preventDefault();
                getLocation('clockInForm');
            });
        }

        if (clockOutForm) {
            clockOutForm.addEventListener('submit', function(e) {
                e.preventDefault();
                getLocation('clockOutForm');
            });
        }
    });
</script>

<style>
    .attendance-container {
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .menu-toggle {
        cursor: pointer;
    }

    .welcome-message {
        font-size: 18px;
        font-weight: bold;
    }

    .attendance-content {
        text-align: center;
    }

    .attendance-btn {
        display: inline-block;
        padding: 10px 20px;
        margin: 10px;
        font-size: 16px;
        cursor: pointer;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        transition: background-color 0.3s;
    }

    .attendance-btn:hover {
        background-color: #0056b3;
    }

    .clock-in {
        background-color: #28a745;
    }

    .clock-out {
        background-color: #dc3545;
    }
</style>
{% endblock %}
